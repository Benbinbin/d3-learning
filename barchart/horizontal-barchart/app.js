// å‚è€ƒè‡ª https://observablehq.com/@d3/horizontal-bar-chart
// è¿™æ˜¯å‚ç›´æ–¹å‘çš„æ¡å½¢å›¾ https://observablehq.com/@d3/bar-chart çš„ã€Œæ°´å¹³æ–¹å‘ã€ç‰ˆæœ¬
// ğŸ’¡ å…¶å®æ ¹æ®å‚ç›´æ–¹å‘çš„æ¡å½¢å›¾ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ¶ä½œæ°´å¹³æ–¹å‘çš„æ¡å½¢å›¾ï¼Œåªéœ€è¦å°†åæ ‡è½´ç›¸äº’è°ƒæ¢ï¼ˆå¹¶å¯¹äºç›¸å…³çš„å…ƒç´ å’Œæ–¹æ³•è¿›è¡Œè°ƒæ•´ï¼‰å³å¯
/**
 *
 * å°†æ„å»ºæ¡å½¢å›¾çš„æ ¸å¿ƒä»£ç å°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆæ–¹ä¾¿å¤ç”¨ï¼‰
 *
 */
// Copyright 2021 Observable, Inc.
// Released under the ISC license.
// https://observablehq.com/@d3/horizontal-bar-chart
function HorizontalBarChart(
  data,
  svg,
  {
    // æ¯ä¸ªæ•°æ®ç‚¹çš„ x å€¼çš„ accessor function è®¿é—®å‡½æ•°
    // ä»æ•°æ®ç‚¹çš„åŸå§‹å€¼ä¸­æå–å‡ºç”¨ä½œæ¨ªåæ ‡å€¼ï¼ˆæ¨ªåæ ‡å€¼åº”è¯¥é‡‡ç”¨ quantitative æ•°å€¼å‹æ•°æ®ï¼Œä»¥è¡¨ç¤ºå…·ä½“å®šé‡çš„å€¼ï¼‰
    x = (d) => d,
    // æ¯ä¸ªæ•°æ®ç‚¹çš„ y å€¼çš„ accessor function è®¿é—®å‡½æ•°
    // ä»æ•°æ®ç‚¹çš„åŸå§‹å€¼ä¸­æå–å‡ºç”¨ä½œçºµåæ ‡å€¼ï¼ˆçºµåæ ‡å€¼åº”è¯¥é‡‡ç”¨ ordinal ç¦»æ•£å‹æ•°æ®ï¼Œä»¥è¡¨ç¤ºä¸åŒç±»åˆ«ï¼‰
    y = (d, i) => i,
    // æ¯ä¸ªæ•°æ®ç‚¹çš„æ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å…¥å‚æ˜¯å„ä¸ªæ•°æ®ç‚¹ d
    title, // ä¸ºæ¯ä¸ªæŸ±å­æ ‡æ³¨çš„ä¿¡æ¯
    titleColor = "white", // æ ‡æ³¨ä¿¡æ¯åœ¨æŸ±å­ä¸Šæ—¶ï¼Œæ–‡å­—çš„é¢œè‰²
    titleAltColor = "currentColor", // æ ‡æ³¨ä¿¡æ¯åœ¨æ¡å½¢å›¾çš„èƒŒæ™¯ä¸Šæ—¶ï¼Œæ–‡å­—çš„é¢œè‰²
    // ä»¥ä¸‹æœ‰ä¸€äº›å…³äºå›¾å½¢çš„å®½é«˜ã€è¾¹è·å°ºå¯¸ç›¸å…³çš„å‚æ•°
    // margin ä¸ºå‰ç¼€çš„äº§ç”Ÿæ˜¯åœ¨å¤–å››è¾¹ç•™ç™½ï¼Œæ„å»ºä¸€ä¸ªæ˜¾ç¤ºçš„å®‰å…¨åŒºï¼Œä»¥ä¾¿åœ¨å››å‘¨æ˜¾ç¤ºåæ ‡è½´
    marginTop = 30, // the top margin, in pixels
    marginRight = 0, // the right margin, in pixels
    marginBottom = 10, // the bottom margin, in pixels
    marginLeft = 30, // the left margin, in pixels
    width = 640, // svg çš„å®½åº¦
    height, // svg çš„é«˜åº¦
    xType = d3.scaleLinear, // æ¨ªè½´æ‰€é‡‡ç”¨çš„æ¯”ä¾‹å°ºï¼Œå¯¹äºæ•°å€¼å‹æ•°æ®ï¼Œé»˜è®¤é‡‡ç”¨çº¿æ€§æ¯”ä¾‹å°º
    xDomain, // æ¨ªåæ ‡è½´çš„å®šä¹‰åŸŸèŒƒå›´ï¼Œå³æ•°æ®çš„èŒƒå›´ [xmin, xmax]
    // æ¨ªåæ ‡è½´çš„å€¼åŸŸï¼ˆå¯è§†åŒ–å±æ€§ï¼Œè¿™é‡Œæ˜¯é•¿åº¦ï¼‰èŒƒå›´ [left, right] ä»å·¦è‡³å³ï¼Œå’Œæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨ä¸€è‡´
    xRange = [marginLeft, width - marginRight],
    xFormat, // æ ¼å¼åŒ–æ•°å­—çš„è¯´æ˜ç¬¦ specifier ç”¨äºæ ¼å¼åŒ–æ¨ªåæ ‡è½´çš„åˆ»åº¦å€¼
    xLabel, // ä¸ºæ¨ªåæ ‡è½´æ·»åŠ é¢å¤–æ–‡æœ¬ï¼ˆä¸€èˆ¬æ˜¯åˆ»åº¦å€¼çš„å•ä½ç­‰ä¿¡æ¯ï¼‰
    // çºµåæ ‡è½´çš„å®šä¹‰åŸŸèŒƒå›´ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„ç±»åˆ«
    // ä¸€èˆ¬æ˜¯åŸºäºåŸå§‹æ•°æ®ï¼ˆå»é‡ï¼‰æå–è€Œæˆçš„
    // ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæ‰‹åŠ¨ç›´æ¥è®¾ç½®å¸Œæœ›æ˜¾ç¤ºçš„ç±»åˆ«ï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨æœ‰ç›¸å…³çš„ä»£ç å¯¹æ•°æ®è¿›è¡Œç­›é€‰
    yDomain, // an array of (ordinal) y-values
    // çºµåæ ‡è½´çš„å€¼åŸŸ
    // å¦‚æœçºµåæ ‡æ˜¯æ˜ å°„å®šé‡æ•°å€¼æ—¶ï¼Œåº”è¯¥ç‰¹åˆ«ç•™æ„ svg çš„åæ ‡ä½“ç³»çš„æ­£æ–¹å‘ï¼ˆå‘å³ï¼Œå‘ä¸‹ï¼‰
    // ä½†æ˜¯å› ä¸ºå½“å‰ç»˜åˆ¶çš„æ˜¯æ¨ªå‘æ¡å½¢å›¾ï¼Œçºµè½´æ˜ å°„çš„æ˜¯åˆ†ç±»æ•°æ®
    // ğŸ’¡ æ‰€ä»¥è¿™é‡Œçš„å€¼åŸŸ**ä¸ä¸€å®šéœ€è¦**é‡‡ç”¨ä»ä¸‹å¾€ä¸Šä¸å®šä¹‰åŸŸè¿›è¡Œæ˜ å°„ [bottom, top]
    // è¿™é‡Œé»˜è®¤å°±é‡‡ç”¨ [top, bottom]
    yRange, // [top, bottom]
    yPadding = 0.1, // è®¾ç½®æ¡å½¢å›¾ä¸­é‚»è¿‘æŸ±å­ä¹‹é—´çš„é—´éš”å¤§å°
    color = "currentColor" // æŸ±å­çš„é¢œè‰²
  } = {}
) {
  /**
   *
   * å¤„ç†æ•°æ®
   *
   */
  // é€šè¿‡ d3.map() è¿­ä»£å‡½æ•°ï¼Œä½¿ç”¨ç›¸åº”çš„ accessor function è®¿é—®å‡½æ•°ä»åŸå§‹æ•°æ® data ä¸­è·å–ç›¸åº”çš„å€¼
  const X = d3.map(data, x);
  const Y = d3.map(data, y);

  /**
   *
   * æ„å»ºæ¯”ä¾‹å°ºå’Œåæ ‡è½´
   *
   */
  // è®¡ç®—åæ ‡è½´çš„å®šä¹‰åŸŸèŒƒå›´
  // æ¨ªåæ ‡è½´çš„å®šä¹‰åŸŸ [xmin, xmax] å…¶ä¸­æœ€å¤§å€¼ xmax ä½¿ç”¨æ–¹æ³• d3.max(X) ä»æ‰€æœ‰æ•°æ®ç‚¹çš„ X å€¼è·å–
  if (xDomain === undefined) xDomain = [0, d3.max(X)];

  // å¦‚æœè°ƒç”¨å‡½æ•°æ—¶æ²¡æœ‰ä¼ å…¥çºµåæ ‡è½´çš„å®šä¹‰åŸŸèŒƒå›´ yDomainï¼Œåˆ™å°†å…¶å…ˆè®¾ç½®ä¸ºç”±æ‰€æœ‰æ•°æ®ç‚¹çš„ y å€¼æ„æˆçš„æ•°ç»„
  if (yDomain === undefined) yDomain = Y;
  // ç„¶ååŸºäº yDomain å€¼åˆ›å»ºä¸€ä¸ª InternSet å¯¹è±¡ï¼Œä»¥ä¾¿å»é‡
  // è¿™æ ·æ‰€å¾—çš„ yDomain é‡Œçš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä½œä¸ºçºµåæ ‡è½´çš„å®šä¹‰åŸŸï¼ˆåˆ†ç±»çš„ä¾æ®ï¼‰
  yDomain = new d3.InternSet(yDomain);

  // è¿™é‡Œè¿˜åšäº†ä¸€æ­¥æ•°æ®æ¸…æ´—
  // åŸºäºçºµåæ ‡è½´çš„å®šä¹‰åŸŸæ‰€åŒ…å«çš„ç±»åˆ«
  // ä½¿ç”¨ JavaScript æ•°ç»„çš„åŸç”Ÿæ–¹æ³• arr.filter() ç­›æ‰ä¸å±äº yDomain ç±»åˆ«çš„ä»»æ„ä¸€ä¸ªçš„æ•°æ®ç‚¹
  // å…¶ä¸­ d3.range(X.length) ç”Ÿæˆä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼ˆä½¿ç”¨ Y.length ä¹Ÿå¯ä»¥ï¼‰ï¼Œä½œä¸ºç´¢å¼•å€¼ï¼Œä¾¿äºå¯¹æ•°æ®ç‚¹è¿›è¡Œè¿­ä»£
  const I = d3.range(X.length).filter((i) => yDomain.has(Y[i]));

  // å¦‚æœè°ƒç”¨å‡½æ•°æ—¶æ²¡æœ‰è®¾ç½®é«˜åº¦ï¼Œåˆ™åŸºäºæŸ±å­çš„æ•°é‡å’Œä¸Šä¸‹çš„ç•™ç™½å®½åº¦ç®—å‡ºé»˜è®¤çš„ svg çš„é«˜åº¦
  // å…¶ä¸­ yDomain.size å¾—åˆ° InternSet å¯¹è±¡ä¸­åŒ…å«çš„å…ƒç´ ä¸ªæ•°ï¼ˆå³ç±»åˆ«æ•°é‡ï¼‰ï¼Œç„¶åè¿™é‡Œå‡è®¾æ¯ä¸ªæŸ±å­å®½åº¦æ˜¯ 25px
  // å…¶ä¸­åŠ ä¸Š yPadding æ˜¯ä¸ºäº†è€ƒè™‘æŸ±å­é—´å­˜åœ¨çš„é—´éš”
  // é€šè¿‡ Math.ceil() æ–¹æ³•è¿›è¡Œå‘ä¸Šä¿®çº¦ï¼ˆè®© svg ç•™è¶³ç©ºé—´æ¥ç»˜åˆ¶æ¡å½¢å›¾ï¼‰
  if (height === undefined)
    height =
      Math.ceil((yDomain.size + yPadding) * 25) + marginTop + marginBottom;
  // ç„¶åè®¡ç®—å‡ºçºµåæ ‡è½´çš„å€¼åŸŸ [top, bottom]
  if (yRange === undefined) yRange = [marginTop, height - marginBottom];

  // æ¨ªåæ ‡è½´çš„æ•°æ®æ˜¯è¿ç»­å‹çš„æ•°å€¼ï¼Œé»˜è®¤ä½¿ç”¨ d3.scaleLinear æ„å»ºä¸€ä¸ªçº¿æ€§æ¯”ä¾‹å°º
  const xScale = xType(xDomain, xRange);
  // æ¨ªè½´æ˜¯ä¸€ä¸ªæœä¸Šçš„åæ ‡è½´
  // å¹¶è®¾ç½®åæ ‡è½´çš„åˆ»åº¦æ•°é‡å’Œåˆ»åº¦å€¼æ ¼å¼
  const xAxis = d3.axisTop(xScale).ticks(width / 80, xFormat);

  // çºµåæ ‡è½´çš„æ•°æ®æ˜¯æ¡å½¢å›¾çš„å„ç§åˆ†ç±»ï¼Œä½¿ç”¨ d3.scaleBand æ„å»ºä¸€ä¸ªå¸¦çŠ¶æ¯”ä¾‹å°º
  // å¹¶è®¾ç½®é—´éš”å æ®ï¼ˆæŸ±å­ï¼‰åŒºé—´çš„æ¯”ä¾‹
  const yScale = d3.scaleBand(yDomain, yRange).padding(yPadding);
  // çºµè½´æ˜¯ä¸€ä¸ªæœå·¦çš„åæ ‡è½´
  // è€Œä¸”å°†åæ ‡è½´çš„å¤–ä¾§åˆ»åº¦ tickSizeOuter é•¿åº¦è®¾ç½®ä¸º 0ï¼ˆå³å–æ¶ˆåæ ‡è½´é¦–å°¾ä¸¤ç«¯çš„åˆ»åº¦ï¼‰
  const yAxis = d3.axisLeft(yScale).tickSizeOuter(0);

  /**
   *
   * æŸ±å­çš„æ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°
   * ç»Ÿä¸€ä¸º**åŸºäºç´¢å¼•**è·å–æ•°æ®ç‚¹çš„æ ‡æ³¨ä¿¡æ¯
   * æ ¹æ®æŸ±å­çš„é•¿çŸ­ï¼Œå†³å®šæ ‡æ³¨æ–‡æœ¬çš„ä¸åŒä½ç½®å’Œé¢œè‰²
   * å¦‚æœæŸ±å­è¾ƒé•¿ï¼Œå°†æ ‡æ³¨ä¿¡æ¯ç½®äºæŸ±å­ä¸Šï¼Œæ–‡æœ¬é¢œè‰²ä¸ºç™½è‰²
   * å¦‚æœæŸ±å­è¾ƒçŸ­ï¼Œå°†æ ‡æ³¨ä¿¡æ¯ç½®äºæŸ±å­æ—è¾¹ï¼ˆåœ¨æ¡å½¢å›¾çš„èƒŒæ™¯ä¸Šï¼‰ï¼Œæ–‡æœ¬çš„é¢œè‰²ä¸ºé»‘è‰²
   *
   */
  // å¦‚æœè°ƒç”¨å‡½æ•°æ—¶æ²¡æœ‰è®¾å®šæ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°
  // åˆ™æ„å»ºä¸€ä¸ª accessor function è®¿é—®å‡½æ•°
  // å®ƒæ¥å—ä¸€ä¸ªè¡¨ç¤ºæ•°æ®ç‚¹çš„ç´¢å¼•å€¼ï¼Œå¹¶ä» X ä¸­åˆ†åˆ«æå–å‡ºæŸ±å­ç›¸åº”çš„é¢‘ç‡ç»„æˆæ ‡æ³¨ä¿¡æ¯
  if (title === undefined) {
    // æ„å»ºä¸€ä¸ªæ•°å€¼æ ¼å¼å™¨ï¼ˆæ ¹æ®è®¾ç½®æ¥è‡ªåŠ¨ç¡®å®šæ•°æ®çš„ç²¾åº¦ï¼Œæ›´é€‚ç”¨äºé˜…è¯»ï¼‰
    const formatValue = xScale.tickFormat(100, xFormat);
    // æ ‡æ³¨ä¿¡æ¯ç”±è¯¥æŸ±å­ç›¸åº”çš„é¢‘ç‡ formatValue(Y[i]) ç»„æˆ
    title = (i) => `${formatValue(X[i])}`;
  } else {
    // å¦‚æœè°ƒç”¨å‡½æ•°æ—¶ç”±è®¾å®šæ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°
    // ä¸ºäº†ä¾¿äºåé¢ç»Ÿä¸€åŸºäºç´¢å¼•å€¼è¿›è¡Œè°ƒç”¨ï¼Œéœ€è¦è¿›è¡Œè½¬æ¢
    // å°† title å˜æˆ**åŸºäºç´¢å¼•**è·å–æ•°æ®ç‚¹çš„æ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°
    const O = d3.map(data, (d) => d);
    const T = title; // å°†åŸå§‹çš„æ ‡æ³¨ä¿¡æ¯è®¿é—®å‡½æ•°èµ‹ç»™ T å˜é‡
    title = (i) => T(O[i], i, data); // title å˜æˆåŸºäºç´¢å¼•çš„æ ‡æ³¨ä¿¡æ¯ accessor function è®¿é—®å‡½æ•°
  }

  /**
   *
   * ç»˜åˆ¶æ¡å½¢å›¾çš„å®¹å™¨ï¼ˆè¾¹æ¡†å’Œåæ ‡è½´ï¼‰
   *
   */
  // ç»˜åˆ¶æ¨ªåæ ‡è½´
  svg
    .append("g")
    // é€šè¿‡è®¾ç½® CSS çš„ transform å±æ€§å°†æ¨ªå‘åæ ‡è½´å®¹å™¨ã€Œç§»åŠ¨ã€åˆ°é¡¶éƒ¨
    .attr("transform", `translate(0,${marginTop})`)
    .call(xAxis) // è°ƒç”¨åæ ‡è½´ï¼ˆå¯¹è±¡ï¼‰æ–¹æ³•ï¼Œå°†åæ ‡è½´åœ¨ç›¸åº”å®¹å™¨å†…éƒ¨æ¸²æŸ“å‡ºæ¥
    .call((g) => g.select(".domain").remove()) // åˆ æ‰ä¸Šä¸€æ­¥æ‰€ç”Ÿæˆçš„åæ ‡è½´çš„è½´çº¿ï¼ˆå®ƒå«æœ‰ domain ç±»åï¼‰
    .call((g) =>
      g
        .selectAll(".tick line")
        .clone() // è¿™é‡Œå¤åˆ¶äº†ä¸€ä»½åˆ»åº¦çº¿ï¼Œç”¨ä»¥ç»˜åˆ¶ç«–å‘çš„å‚è€ƒçº¿
        .attr("y2", height - marginTop - marginBottom) // è°ƒæ•´å¤åˆ¶åçš„åˆ»åº¦çº¿çš„ç»ˆç‚¹ä½ç½®ï¼ˆå¾€ä¸‹ç§»åŠ¨ï¼‰
        .attr("stroke-opacity", 0.1)
    ) // è°ƒå°ç½‘æ ¼çº¿çš„é€æ˜åº¦
    .call((g) =>
      g
        .append("text") // ä¸ºåæ ‡è½´æ·»åŠ é¢å¤–ä¿¡æ¯åç§°ï¼ˆä¸€èˆ¬æ˜¯åˆ»åº¦å€¼çš„å•ä½ç­‰ä¿¡æ¯ï¼‰
        // å°†è¯¥æ–‡æœ¬ç§»åŠ¨åˆ°å®¹å™¨çš„å³ä¾§
        .attr("x", width - marginRight)
        .attr("y", -22)
        .attr("fill", "currentColor")
        .attr("text-anchor", "end") // è®¾ç½®æ–‡æœ¬çš„å¯¹é½æ–¹å¼
        .text(xLabel)
    ); // æ–‡æœ¬å†…å®¹

  // ç»˜åˆ¶çºµåæ ‡è½´
  svg
    .append("g")
    .attr("transform", `translate(${marginLeft},0)`) // å°†çºµåæ ‡è½´å®¹å™¨å®šä½åˆ°å·¦ä¾§
    .call(yAxis);

  /**
   *
   * ç»˜åˆ¶æ¡å½¢å›¾å†…çš„æŸ±å­
   *
   */
  svg
    .append("g")
    .attr("fill", color)
    // ä½¿ç”¨ <rect> å…ƒç´ æ¥ç»˜åˆ¶æŸ±å­
    // é€šè¿‡è®¾ç½®çŸ©å½¢çš„å·¦ä¸Šè§’ (x, y) åŠå…¶ width å’Œ height æ¥ç¡®å®šå…¶å®šä½å’Œå½¢çŠ¶
    .selectAll("rect")
    .data(I) // ç»‘å®šçš„æ•°æ®æ˜¯è¡¨ç¤ºæ•°æ®ç‚¹çš„ç´¢å¼•å€¼ï¼ˆæ•°ç»„ï¼‰ï¼Œä»¥ä¸‹ä¼šé€šè¿‡ç´¢å¼•å€¼æ¥è·å–å„æŸ±å­ç›¸åº”çš„æ•°æ®
    .join("rect")
    // å› ä¸ºç»˜åˆ¶çš„æ˜¯æ°´å¹³æ–¹å‘çš„æ¡å½¢å›¾
    // æ‰€ä»¥æ¯ä¸ªæŸ±å­éƒ½æ˜¯å¯¹é½åˆ° y è½´çš„ï¼Œå³çŸ©å½¢çš„å·¦ä¸Šè§’æ¨ªåæ ‡å€¼éƒ½æ˜¯ xScale(0)
    .attr("x", xScale(0))
    // é€šè¿‡ç´¢å¼•å€¼æ¥è¯»å–çŸ©å½¢çš„å·¦ä¸Šè§’çºµåæ ‡å€¼
    .attr("y", (i) => yScale(Y[i]))
    // çŸ©å½¢çš„å®½åº¦
    // å³æ°´å¹³æŸ±å­çš„é•¿åº¦ï¼Œé€šè¿‡æ¯”ä¾‹å°ºæ˜ å°„åï¼ŒæŸ±å­çš„å®½åº¦æ˜¯ xScale(X[i]) - xScale(0)) çš„å·®å€¼
    .attr("width", (i) => xScale(X[i]) - xScale(0))
    // çŸ©å½¢çš„é«˜åº¦
    // å³æŸ±å­çš„å¤§å°ï¼Œé€šè¿‡çºµè½´çš„æ¯”ä¾‹å°ºçš„æ–¹æ³• yScale.bandwidth() è·å– band çš„å®½åº¦ï¼ˆä¸åŒ…å«é—´éš™ paddingï¼‰
    .attr("height", yScale.bandwidth());

  // è®¾ç½®æ¯ä¸ªæŸ±å­çš„æ ‡æ³¨ä¿¡æ¯
  // ä¹‹å‰åœ¨å‚ç›´æ¡å½¢å›¾ä¸­ï¼Œåªæœ‰å½“é¼ æ ‡ hover åœ¨æŸ±å­ä¸Šæ‰æ˜¾ç¤ºçš„æ ‡æ³¨ä¿¡æ¯ï¼Œ
  // ğŸ’¡ è€Œç°åœ¨ç”±äºæ¡å½¢å›¾æ˜¯æ¨ªå‘çš„ï¼Œä¸æ–‡å­—é˜…è¯»æ–¹å‘ç›¸åŒï¼Œæ‰€ä»¥ç°åœ¨æœ‰è¶³å¤Ÿçš„ä½ç½®å¯ä»¥ç›´æ¥æ˜¾ç¤ºåœ¨ç›¸åº”çš„æŸ±å­ä¸Š
  svg
    .append("g")
    // å…ˆé»˜è®¤æ ‡æ³¨ä¿¡æ¯éƒ½åœ¨æŸ±å­ä¸Šï¼Œè®¾ç½®æ–‡å­—çš„é¢œè‰²
    .attr("fill", titleColor)
    // å› ä¸ºé»˜è®¤æ–‡æœ¬åœ¨æŸ±å­çš„æœ€å³ä¾§ï¼Œæ‰€ä»¥å¯¹é½æ–¹å¼è®¾ç½®ä¸º end
    // å³æ–‡æœ¬çš„ (x, y) å®šä½åæ ‡æ˜¯å…¶æœ«å°¾ï¼Œæ–‡å­—å‘å·¦å±•å¼€
    .attr("text-anchor", "end")
    .attr("font-family", "sans-serif")
    .attr("font-size", 10)
    .selectAll("text")
    .data(I) // ç»‘å®šçš„æ•°æ®æ˜¯è¡¨ç¤ºæ•°æ®ç‚¹çš„ç´¢å¼•å€¼ï¼ˆæ•°ç»„ï¼‰ï¼Œä»¥ä¸‹ä¼šé€šè¿‡ç´¢å¼•å€¼æ¥è·å–å„æŸ±å­ç›¸åº”æ ‡æ³¨ä¿¡æ¯
    .join("text")
    // å°†æ–‡æœ¬ç§»åŠ¨åˆ°ç›¸åº”çš„æŸ±å­ä¸Š
    .attr("x", (i) => xScale(X[i])) // æ–‡æœ¬çš„æ¨ªå‘åæ ‡ï¼Œç§»åˆ°æŸ±å­çš„æœ€å³ä¾§
    .attr("y", (i) => yScale(Y[i]) + yScale.bandwidth() / 2) // æ–‡æœ¬çš„çºµå‘åæ ‡
    .attr("dy", "0.35em")
    .attr("dx", -4)
    .text(title)
    // æœ€åå†åŸºäºæŸ±å­çš„é•¿åº¦å¯¹æ–‡æœ¬çš„å®šä½å’Œé¢œè‰²è¿›è¡Œè°ƒæ•´
    .call((text) =>
      // ç­›é€‰å‡ºè¾ƒçŸ­çš„æŸ±å­æ‰€å¯¹åº”çš„æ–‡æœ¬
      // å½“çŸ©å½¢çš„é•¿åº¦ xScale(X[i]) - xScale(0) å°äº 20 æ—¶å°±æ˜¯è¾ƒçŸ­çš„æŸ±å­
      text
        .filter((i) => xScale(X[i]) - xScale(0) < 20) // short bars
        .attr("dx", +4) // å°†æ–‡æœ¬ç¨å¾®å‘å³ç§»åŠ¨ï¼Œè¿™æ ·æ–‡æœ¬å°±ä½äºæ¡å½¢å›¾çš„ç™½è‰²èƒŒæ™¯ä¸Šï¼ˆè€Œä¸æ˜¯å½©è‰²çš„æŸ±å­ä¸Šï¼‰
        .attr("fill", titleAltColor) // æ‰€ä»¥éœ€è¦å°†ç™½è‰²çš„æ–‡å­—æ”¹æˆé»‘è‰²çš„æ–‡å­—
        // è€Œä¸”æ”¹å˜æ–‡å­—çš„å¯¹é½æ–¹å¼ä¸º startï¼Œå³æ–‡æœ¬çš„ (x, y) å®šä½åæ ‡æ˜¯å…¶å¼€å¤´ï¼Œæ–‡å­—å‘å³å±•å¼€
        .attr("text-anchor", "start")
    );

  return svg.node();
}

/**
 *
 * æ„å»º svg
 *
 */
const container = document.getElementById("container"); // å›¾åƒçš„å®¹å™¨

// è·å–å°ºå¯¸å¤§å°
const width = container.clientWidth; // å®½åº¦
const height = container.clientHeight; // é«˜åº¦
const margin = { top: 30, right: 30, bottom: 30, left: 30 };

// åˆ›å»º svg
// åœ¨å®¹å™¨ <div id="container"> å…ƒç´ å†…åˆ›å»ºä¸€ä¸ª SVG å…ƒç´ 
// è¿”å›ä¸€ä¸ªé€‰æ‹©é›†ï¼Œåªæœ‰ svg ä¸€ä¸ªå…ƒç´ 
const svg = d3
  .select("#container")
  .append("svg")
  .attr("width", width)
  .attr("height", height)
  .attr("viewBox", [-margin.left, -margin.top, width, height]);

/**
 *
 * å¼‚æ­¥è·å–æ•°æ®
 * å†åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œç»˜åˆ¶æ“ä½œ
 *
 */
// æ•°æ®æ¥æºç½‘é¡µ https://observablehq.com/@d3/horizontal-bar-chart çš„æ–‡ä»¶é™„ä»¶
const dataURL =
  "https://gist.githubusercontent.com/Benbinbin/04f66f9f466d8293c798cefdd8a36021/raw/686830fb1232d7ea7ca8014b3bf959ab928e173a/alphabet.csv";

d3.csv(dataURL, d3.autoType).then((data) => {
  // éœ€è¦æ£€æŸ¥ä¸€ä¸‹æ•°æ®è§£æçš„ç»“æœï¼Œå¯èƒ½å¹¶ä¸æ­£ç¡®ï¼Œéœ€è¦åœ¨åé¢çš„æ­¥éª¤é‡Œå†è¿›è¡Œç›¸åº”çš„å¤„ç†
  console.log(data);

  // æ„å»ºæ•£ç‚¹å›¾çŸ©é˜µ
  HorizontalBarChart(data, svg, {
    x: (d) => d.frequency,
    y: (d) => d.letter,
    // è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼ å…¥çºµè½´çš„å®šä¹‰åŸŸ yDomain æ‰‹åŠ¨è®¾ç½®åˆ†ç»„ç±»åˆ«
    // å¹¶ä¸”ç±»åˆ«æ˜¯æŒ‰ç…§å…¶ç›¸åº”çš„é¢‘æ¬¡è¿›è¡Œé™åºæ’åˆ—çš„
    // ä½¿ç”¨æ–¹æ³• d3.groupSort(iterable, accessor, key) å¯¹å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚æ•°ç»„ï¼‰iterable è¿›è¡Œå½’ç±»åˆ†ç»„ï¼Œå…¶ä¸­ key æŒ‡å®šåˆ†ç»„çš„ä¾æ®
    // æœ€åè¿”å›ï¼ˆæ’åºå¥½çš„ï¼‰ç±»åˆ«æ•°ç»„ï¼Œæœ€ç»ˆçš„è¾“å‡ºå€¼å¯ä»¥æŸ¥çœ‹ ğŸ‘‡ ä¸‹ä¸€ä¸ª cell æ‰€æ¼”ç¤ºçš„ç»“æœ
    // ç”±äºè¯¥æ–¹æ³•é»˜è®¤æŒ‰ç…§ accessor è®¿é—®å™¨çš„è¿”å›å€¼å‡åºæ’åˆ—ï¼Œè¿™é‡Œæ˜¯å¸Œæœ›é™åºæ’åˆ—ï¼Œä»…ä»…éœ€è¦åœ¨è¿”å›å€¼å‰é¢æ·»åŠ è´Ÿå· - å³å¯
    yDomain: d3.groupSort(
      data,
      ([d]) => -d.frequency,
      (d) => d.letter
    ),
    xFormat: "%", // æ¨ªè½´çš„åˆ»åº¦å€¼é‡‡ç”¨ç™¾åˆ†æ¯”è¡¨ç¤º
    xLabel: "Frequency â†’",
    marginTop: margin.top, // the top margin, in pixels
    marginRight: margin.right, // the right margin, in pixels
    marginBottom: margin.bottom, // the bottom margin, in pixels
    marginLeft: margin.left, // t
    width: width,
    height: height,
    color: "steelblue"
  });
});
