// å‚è€ƒè‡ª https://observablehq.com/@d3/bar-chart

/**
 *
 * å°†æ„å»ºæ¡å½¢å›¾çš„æ ¸å¿ƒä»£ç å°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆæ–¹ä¾¿å¤ç”¨ï¼‰
 *
 */
// Copyright 2021 Observable, Inc.
// Released under the ISC license.
// https://observablehq.com/@d3/bar-chart
function BarChart(
  data,
  svg,
  {
    // æ¯ä¸ªæ•°æ®ç‚¹çš„ x å€¼çš„ accessor function è®¿é—®å‡½æ•°
    // ä»æ•°æ®ç‚¹çš„åŸå§‹å€¼ä¸­æå–å‡ºç”¨ä½œæ¨ªåæ ‡å€¼ï¼ˆæ¨ªåæ ‡å€¼åº”è¯¥é‡‡ç”¨ ordinal ç¦»æ•£å‹æ•°æ®ï¼Œä»¥è¡¨ç¤ºä¸åŒç±»åˆ«ï¼‰
    // é»˜è®¤é‡‡ç”¨æ•°æ®ç‚¹çš„**åºæ•°**ä½œä¸ºæ¨ªåæ ‡å€¼
    x = (d, i) => i,
    // æ¯ä¸ªæ•°æ®ç‚¹çš„ y å€¼çš„ accessor function è®¿é—®å‡½æ•°
    // ä»æ•°æ®ç‚¹çš„åŸå§‹å€¼ä¸­æå–å‡ºç”¨ä½œçºµåæ ‡å€¼ï¼ˆçºµåæ ‡å€¼åº”è¯¥é‡‡ç”¨ quantitative æ•°å€¼å‹æ•°æ®ï¼Œä»¥è¡¨ç¤ºå…·ä½“å®šé‡çš„å€¼ï¼‰
    y = (d) => d,
    // æ¯ä¸ªæ•°æ®ç‚¹çš„æ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å…¥å‚æ˜¯å„ä¸ªæ•°æ®ç‚¹ d
    title,
    // ä»¥ä¸‹æœ‰ä¸€äº›å…³äºå›¾å½¢çš„å®½é«˜ã€è¾¹è·å°ºå¯¸ç›¸å…³çš„å‚æ•°
    // åœ¨å¤–å››è¾¹ç•™ç™½ï¼Œæ„å»ºä¸€ä¸ªæ˜¾ç¤ºçš„å®‰å…¨åŒºï¼Œä»¥ä¾¿åœ¨å››å‘¨æ˜¾ç¤ºåæ ‡è½´
    marginTop = 20, // the top margin, in pixels
    marginRight = 0, // the right margin, in pixels
    marginBottom = 30, // the bottom margin, in pixels
    marginLeft = 40, // the left margin, in pixels
    width = 640, // svg çš„å®½åº¦
    height = 400, // svg çš„é«˜åº¦
    // æ¨ªåæ ‡è½´çš„å®šä¹‰åŸŸèŒƒå›´ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„ç±»åˆ«
    // ä¸€èˆ¬æ˜¯åŸºäºåŸå§‹æ•°æ®ï¼ˆå»é‡ï¼‰æå–è€Œæˆçš„
    // ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæ‰‹åŠ¨ç›´æ¥è®¾ç½®å¸Œæœ›æ˜¾ç¤ºçš„ç±»åˆ«ï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨æœ‰ç›¸å…³çš„ä»£ç å¯¹æ•°æ®è¿›è¡Œç­›é€‰
    xDomain,
    // æ¨ªåæ ‡è½´çš„å€¼åŸŸï¼ˆå¯è§†åŒ–å±æ€§ï¼Œè¿™é‡Œæ˜¯é•¿åº¦ï¼‰èŒƒå›´ [left, right] ä»å·¦è‡³å³ï¼Œå’Œæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨ä¸€è‡´
    xRange = [marginLeft, width - marginRight], // [left, right]
    yType = d3.scaleLinear, // çºµè½´æ‰€é‡‡ç”¨çš„æ¯”ä¾‹å°ºï¼Œå¯¹äºæ•°å€¼å‹æ•°æ®ï¼Œé»˜è®¤é‡‡ç”¨çº¿æ€§æ¯”ä¾‹å°º
    yDomain, // çºµåæ ‡è½´çš„å®šä¹‰åŸŸèŒƒå›´ [ymin, ymax]
    // âš ï¸ åº”è¯¥ç‰¹åˆ«ç•™æ„çºµåæ ‡è½´çš„å€¼åŸŸï¼ˆå¯è§†åŒ–å±æ€§ï¼Œè¿™é‡Œæ˜¯é•¿åº¦ï¼‰èŒƒå›´ [bottom, top]
    // ç”±äº svg çš„åæ ‡ä½“ç³»ä¸­å‘ä¸‹å’Œå‘å³æ˜¯æ­£æ–¹å‘ï¼Œå’Œæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ä¸ä¸€è‡´
    // æ‰€ä»¥è¿™é‡Œçš„å€¼åŸŸèŒƒå›´éœ€è¦é‡‡ç”¨ä»ä¸‹å¾€ä¸Šä¸å®šä¹‰åŸŸè¿›è¡Œæ˜ å°„
    yRange = [height - marginBottom, marginTop], // [bottom, top]
    // è®¾ç½®æ¡å½¢å›¾ä¸­é‚»è¿‘æŸ±å­ä¹‹é—´çš„é—´éš”å¤§å°
    // è¯¥å‚æ•°æ˜¯è®¾ç½®æ¨ªè½´å€¼åŸŸçš„å†…å¤–é—´éš”ç³»æ•°ï¼Œè¯¥å€¼éœ€è¦å°äºï¼ˆæˆ–ç­‰äºï¼‰1ï¼Œè¡¨ç¤ºç•™ç©ºçš„é—´éš”å æ®ï¼ˆæŸ±å­ï¼‰åŒºé—´çš„æ¯”ä¾‹
    xPadding = 0.1,
    yFormat, // æ ¼å¼åŒ–æ•°å­—çš„è¯´æ˜ç¬¦ specifier ç”¨äºæ ¼å¼åŒ–çºµåæ ‡è½´çš„åˆ»åº¦å€¼
    yLabel, // ä¸ºçºµåæ ‡è½´æ·»åŠ é¢å¤–æ–‡æœ¬ï¼ˆä¸€èˆ¬æ˜¯åˆ»åº¦å€¼çš„å•ä½ç­‰ä¿¡æ¯ï¼‰
    color = "currentColor" // æŸ±å­çš„é¢œè‰²
  } = {}
) {
  /**
   *
   * å¤„ç†æ•°æ®
   *
   */
  // é€šè¿‡ d3.map() è¿­ä»£å‡½æ•°ï¼Œä½¿ç”¨ç›¸åº”çš„ accessor function è®¿é—®å‡½æ•°ä»åŸå§‹æ•°æ® data ä¸­è·å–ç›¸åº”çš„å€¼
  const X = d3.map(data, x);
  const Y = d3.map(data, y);

  /**
   *
   * æ„å»ºæ¯”ä¾‹å°ºå’Œåæ ‡è½´
   *
   */
  // è®¡ç®—åæ ‡è½´çš„å®šä¹‰åŸŸèŒƒå›´
  // å¦‚æœè°ƒç”¨å‡½æ•°æ—¶æ²¡æœ‰ä¼ å…¥æ¨ªåæ ‡è½´çš„å®šä¹‰åŸŸèŒƒå›´ xDomainï¼Œåˆ™å°†å…¶å…ˆè®¾ç½®ä¸ºç”±æ‰€æœ‰æ•°æ®ç‚¹çš„ x å€¼æ„æˆçš„æ•°ç»„
  if (xDomain === undefined) xDomain = X;
  // ç„¶ååŸºäº xDomain å€¼åˆ›å»ºä¸€ä¸ª InternSet å¯¹è±¡ï¼Œä»¥ä¾¿å»é‡
  // è¿™æ ·æ‰€å¾—çš„ xDomain é‡Œçš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä½œä¸ºæ¨ªåæ ‡è½´çš„å®šä¹‰åŸŸï¼ˆåˆ†ç±»çš„ä¾æ®ï¼‰
  xDomain = new d3.InternSet(xDomain);
  // çºµåæ ‡è½´çš„å®šä¹‰åŸŸ [ymin, ymax] å…¶ä¸­æœ€å¤§å€¼ ymax ä½¿ç”¨æ–¹æ³• d3.max(Y) ä»æ‰€æœ‰æ•°æ®ç‚¹çš„ y å€¼è·å–
  if (yDomain === undefined) yDomain = [0, d3.max(Y)];

  // è¿™é‡Œè¿˜åšäº†ä¸€æ­¥æ•°æ®æ¸…æ´—
  // åŸºäºæ¨ªåæ ‡è½´çš„å®šä¹‰åŸŸæ‰€åŒ…å«çš„ç±»åˆ«
  // ä½¿ç”¨ JavaScript æ•°ç»„çš„åŸç”Ÿæ–¹æ³• arr.filter() ç­›æ‰ä¸å±äº xDomain ç±»åˆ«çš„ä»»æ„ä¸€ä¸ªçš„æ•°æ®ç‚¹
  // å…¶ä¸­ d3.range(X.length) ç”Ÿæˆä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼Œä½œä¸ºç´¢å¼•å€¼ï¼Œä¾¿äºå¯¹æ•°æ®ç‚¹è¿›è¡Œè¿­ä»£
  const I = d3.range(X.length).filter((i) => xDomain.has(X[i]));

  // æ¨ªåæ ‡è½´çš„æ•°æ®æ˜¯æ¡å½¢å›¾çš„å„ç§åˆ†ç±»ï¼Œä½¿ç”¨ d3.scaleBand æ„å»ºä¸€ä¸ªå¸¦çŠ¶æ¯”ä¾‹å°º
  // å¹¶è®¾ç½®é—´éš”å æ®ï¼ˆæŸ±å­ï¼‰åŒºé—´çš„æ¯”ä¾‹
  const xScale = d3.scaleBand(xDomain, xRange).padding(xPadding);
  // æ¨ªè½´æ˜¯ä¸€ä¸ªæœä¸‹çš„åæ ‡è½´
  // è€Œä¸”å°†åæ ‡è½´çš„å¤–ä¾§åˆ»åº¦ tickSizeOuter é•¿åº¦è®¾ç½®ä¸º 0ï¼ˆå³å–æ¶ˆåæ ‡è½´é¦–å°¾ä¸¤ç«¯çš„åˆ»åº¦ï¼‰
  const xAxis = d3.axisBottom(xScale).tickSizeOuter(0);

  // çºµåæ ‡è½´çš„æ•°æ®æ˜¯è¿ç»­å‹çš„æ•°å€¼ï¼Œé»˜è®¤ä½¿ç”¨ d3.scaleLinear æ„å»ºä¸€ä¸ªçº¿æ€§æ¯”ä¾‹å°º
  const yScale = yType(yDomain, yRange);
  // çºµè½´æ˜¯ä¸€ä¸ªæœå·¦çš„åæ ‡è½´
  // å¹¶è®¾ç½®åæ ‡è½´çš„åˆ»åº¦æ•°é‡å’Œåˆ»åº¦å€¼æ ¼å¼
  const yAxis = d3.axisLeft(yScale).ticks(height / 40, yFormat);

  /**
   *
   * è®¾ç½®æŸ±å­çš„æ ‡æ³¨ä¿¡æ¯
   * å½“é¼ æ ‡ hover åœ¨æŸ±å­ä¸Šæ—¶ä¼šæ˜¾ç¤ºç›¸åº”çš„ä¿¡æ¯
   *
   */
  // å¦‚æœè°ƒç”¨å‡½æ•°æ—¶æ²¡æœ‰è®¾å®šæ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°
  // åˆ™æ„å»ºä¸€ä¸ª accessor function è®¿é—®å‡½æ•°
  // å®ƒæ¥å—ä¸€ä¸ªè¡¨ç¤ºæ•°æ®ç‚¹çš„ç´¢å¼•å€¼ï¼Œå¹¶ä» X å’Œ Y ä¸­åˆ†åˆ«æå–å‡ºæŸ±å­æ‰€å±çš„ç±»åˆ«å’Œç›¸åº”çš„é¢‘ç‡ç»„æˆæ ‡æ³¨ä¿¡æ¯
  if (title === undefined) {
    // é™¤äº†åæ ‡è½´å¯¹è±¡ï¼ˆå‰é¢çš„ yAxisï¼‰å¯ä»¥è®¾ç½®åˆ»åº¦å€¼æ ¼å¼å¤–
    // æ¯”ä¾‹å°ºæœ¬èº«ä¹Ÿæœ‰ä¸åˆ»åº¦å€¼æ ¼å¼ç›¸å…³çš„æ–¹æ³• .tickFormat
    // ä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¿”å›å€¼çš„ä¸æ˜¯æ¯”ä¾‹å°ºï¼ˆä¸€èˆ¬éƒ½æ˜¯è¿”å›è°ƒç”¨å¯¹è±¡ï¼Œå³æ¯”ä¾‹å°ºæœ¬èº«ï¼Œä¾¿äºè¿›è¡Œé“¾å¼è°ƒç”¨ï¼‰è€Œæ˜¯ä¸€ä¸ªæ ¼å¼å™¨
    // å¦‚æœæ˜¯è¿ç»­å‹æ¯”ä¾‹å°ºè°ƒç”¨æ–¹æ³• continuous.tickFormat([count[, specifier]]) åˆ™è¿”å›ä¸€ä¸ª**æ•°å€¼æ ¼å¼å™¨**
    // å…·ä½“å¯ä»¥å‚è€ƒ https://github.com/d3/d3-scale#continuous_tickFormat
    // æ•°å€¼æ ¼å¼å™¨è®¾è®¡åˆè¡·æ˜¯å¯¹ä¼ å…¥çš„å€¼è¿›è¡Œå¤„ç†ï¼Œè½¬æ¢å¾—åˆ°ä¸€ä¸ªå€¼æ›´é€‚ç”¨äºä½œä¸ºåˆ»åº¦å€¼ï¼Ÿ
    // æ‰€ä»¥ä¸»è¦çš„ä½œç”¨æ˜¯å¯¹ä¼ å…¥çš„å€¼è¿›è¡Œä¿®çº¦ï¼ˆæ”¹å˜ç²¾åº¦ï¼Œè®©åˆ»åº¦å€¼æ›´æ˜“è¯»ï¼‰ï¼Œè¿˜å¯ä»¥è¿›è¡Œæ ¼å¼è½¬æ¢ï¼ˆå¦‚å˜æˆç™¾åˆ†æ¯”ï¼‰
    // æ•°å€¼æ ¼å¼å™¨ä¼šæ ¹æ®æ¯”ä¾‹å°ºçš„å®šä¹‰åŸŸï¼ˆè¯¥å®ä¾‹çš„å®šä¹‰åŸŸæ˜¯ [0, 0.12702]ï¼‰è‡ªåŠ¨å†³å®šåˆ»åº¦å€¼çš„ç²¾åº¦
    // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è®¾ç½®é¢„æœŸçš„åˆ»åº¦çº¿æ•°é‡ï¼Œåˆ»åº¦çº¿è¶Šå¤šï¼Œåˆ™åˆ»åº¦å€¼çš„ç²¾åº¦ç›¸å¯¹å°±ä¼šè¶Šé«˜
    // ç¬¬äºŒä¸ªå‚æ•°æ˜¯è®¾ç½®åˆ»åº¦å€¼çš„æ ¼å¼
    const formatValue = yScale.tickFormat(100, yFormat);
    // æ ‡æ³¨ä¿¡æ¯æœ‰è¯¥æŸ±å­æ‰€å±çš„ç±»åˆ« X[i] åŠå…¶ç›¸åº”çš„é¢‘ç‡ formatValue(Y[i]) ç»„æˆ
    title = (i) => `${X[i]}\n${formatValue(Y[i])}`;
  } else {
    // å¦‚æœè°ƒç”¨å‡½æ•°æ—¶ç”±è®¾å®šæ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°
    // ä¸ºäº†ä¾¿äºåé¢ç»Ÿä¸€åŸºäºç´¢å¼•å€¼è¿›è¡Œè°ƒç”¨ï¼Œéœ€è¦è¿›è¡Œè½¬æ¢
    // å°† title å˜æˆ**åŸºäºç´¢å¼•**è·å–æ•°æ®ç‚¹çš„æ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°
    const O = d3.map(data, (d) => d); // å®é™…å°±æ˜¯åŸå§‹æ•°æ®
    const T = title; // å°†åŸå§‹çš„æ ‡æ³¨ä¿¡æ¯è®¿é—®å‡½æ•°èµ‹ç»™ T å˜é‡

    // åŸå§‹çš„è®¿é—®å‡½æ•° T å°±æ˜¯æ¥æ”¶æ•°æ®ç‚¹çš„åŸå§‹å€¼ O[i] ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ç›¸åº”çš„æ ‡æ³¨ä¿¡æ¯
    title = (i) => T(O[i], i, data); // title å˜æˆåŸºäºç´¢å¼•çš„æ ‡æ³¨ä¿¡æ¯ accessor function è®¿é—®å‡½æ•°
  }

  /**
   *
   * ç»˜åˆ¶æ¡å½¢å›¾çš„å®¹å™¨ï¼ˆè¾¹æ¡†å’Œåæ ‡è½´ï¼‰
   *
   */
  // ç»˜åˆ¶çºµåæ ‡è½´
  svg
    .append("g")
    // é€šè¿‡è®¾ç½® CSS çš„ transform å±æ€§å°†çºµå‘åæ ‡è½´å®¹å™¨ã€Œç§»åŠ¨ã€åˆ°å·¦ä¾§
    .attr("transform", `translate(${marginLeft},0)`)
    // è°ƒç”¨åæ ‡è½´ï¼ˆå¯¹è±¡ï¼‰æ–¹æ³•ï¼Œå°†åæ ‡è½´åœ¨ç›¸åº”å®¹å™¨å†…éƒ¨æ¸²æŸ“å‡ºæ¥
    .call(yAxis)
    .call((g) => g.select(".domain").remove()) // åˆ æ‰ä¸Šä¸€æ­¥æ‰€ç”Ÿæˆçš„åæ ‡è½´çš„è½´çº¿ï¼ˆå®ƒå«æœ‰ domain ç±»åï¼‰
    .call((g) =>
      g
        .selectAll(".tick line")
        .clone() // è¿™é‡Œå¤åˆ¶äº†ä¸€ä»½åˆ»åº¦çº¿ï¼Œç”¨ä»¥ç»˜åˆ¶æ¨ªå‘çš„å‚è€ƒçº¿
        .attr("x2", width - marginLeft - marginRight) // è°ƒæ•´å¤åˆ¶åçš„åˆ»åº¦çº¿çš„ç»ˆç‚¹ä½ç½®ï¼ˆå¾€å³ç§»åŠ¨ï¼‰
        .attr("stroke-opacity", 0.1)
    ) // è°ƒå°ç½‘æ ¼çº¿çš„é€æ˜åº¦
    .call((g) =>
      g
        .append("text") // ä¸ºåæ ‡è½´æ·»åŠ é¢å¤–ä¿¡æ¯åç§°ï¼ˆä¸€èˆ¬æ˜¯åˆ»åº¦å€¼çš„å•ä½ç­‰ä¿¡æ¯ï¼‰
        // å°†è¯¥æ–‡æœ¬ç§»åŠ¨åˆ°å®¹å™¨çš„å·¦ä¸Šè§’
        .attr("x", -marginLeft)
        .attr("y", 10)
        .attr("fill", "currentColor")
        .attr("text-anchor", "start") // è®¾ç½®æ–‡æœ¬çš„å¯¹é½æ–¹å¼
        .text(yLabel)
    ); // æ–‡æœ¬å†…å®¹

  // ç»˜åˆ¶çºµåæ ‡è½´
  svg
    .append("g")
    .attr("transform", `translate(0,${height - marginBottom})`) // å°†æ¨ªåæ ‡è½´å®¹å™¨å®šä½åˆ°åº•éƒ¨
    .call(xAxis);

  /**
   *
   * ç»˜åˆ¶æ¡å½¢å›¾å†…çš„æŸ±å­
   *
   */
  const bar = svg
    .append("g")
    .attr("fill", color)
    // ä½¿ç”¨ <rect> å…ƒç´ æ¥ç»˜åˆ¶æŸ±å­
    // é€šè¿‡è®¾ç½®çŸ©å½¢çš„å·¦ä¸Šè§’ (x, y) åŠå…¶ width å’Œ height æ¥ç¡®å®šå…¶å®šä½å’Œå½¢çŠ¶
    .selectAll("rect")
    .data(I) // ç»‘å®šçš„æ•°æ®æ˜¯è¡¨ç¤ºæ•°æ®ç‚¹çš„ç´¢å¼•å€¼ï¼ˆæ•°ç»„ï¼‰ï¼Œä»¥ä¸‹ä¼šé€šè¿‡ç´¢å¼•å€¼æ¥è·å–å„æŸ±å­ç›¸åº”çš„æ•°æ®
    .join("rect")
    .attr("x", (i) => xScale(X[i])) // é€šè¿‡ç´¢å¼•å€¼æ¥è¯»å–æŸ±å­çš„å·¦ä¸Šè§’æ¨ªåæ ‡å€¼
    .attr("y", (i) => yScale(Y[i])) // é€šè¿‡ç´¢å¼•å€¼æ¥è¯»å–æŸ±å­çš„å·¦ä¸Šè§’çºµåæ ‡å€¼
    // æŸ±å­çš„é«˜åº¦
    // âš ï¸ åº”è¯¥ç‰¹åˆ«ç•™æ„å› ä¸ºåœ¨ svg çš„åæ ‡ä½“ç³»ä¸­å‘ä¸‹å’Œå‘å³æ˜¯æ­£æ–¹å‘
    //  æ‰€ä»¥é€šè¿‡æ¯”ä¾‹å°ºæ˜ å°„åï¼Œåœ¨ svg åæ ‡ä½“ç³»é‡Œï¼ŒæŸ±å­åº•éƒ¨çš„ y å€¼ï¼ˆå³ yScale(0)ï¼‰æ˜¯å¤§äºæŸ±å­é¡¶éƒ¨çš„ y å€¼ï¼ˆå³ yScale(Y[i])ï¼‰ï¼Œæ‰€ä»¥æŸ±å­çš„é«˜åº¦æ˜¯ yScale(0) - yScale(Y[i]) çš„å·®å€¼
    .attr("height", (i) => yScale(0) - yScale(Y[i]))
    // æŸ±å­çš„å®½åº¦
    // é€šè¿‡æ¨ªè½´çš„æ¯”ä¾‹å°ºçš„æ–¹æ³• xScale.bandwidth() è·å– band çš„å®½åº¦ï¼ˆä¸åŒ…å«é—´éš™ paddingï¼‰
    // è¿™é‡Œä¸éœ€è¦é€šè¿‡ç´¢å¼•å€¼æ¥è·å–æ¯ä¸ªæŸ±å­çš„å®½åº¦ï¼Œå› ä¸ºæ¯ä¸€ä¸ªæŸ±å­çš„å®½åº¦éƒ½ç›¸åŒ
    .attr("width", xScale.bandwidth());

  // è®¾ç½®æ¯ä¸ªæŸ±å­çš„æ ‡æ³¨ä¿¡æ¯
  if (title)
    bar
      .append("title")
      // è¿™é‡Œé€šè¿‡æ ‡æ³¨ä¿¡æ¯çš„ accessor function è®¿é—®å‡½æ•°
      // title è®¿é—®å‡½æ•°çš„å…¥å‚æ˜¯ç´¢å¼•å€¼ï¼ˆæ¯ä¸ª bar åœ¨ä¸Šä¸€æ­¥éƒ½ç»‘å®šäº†æ•°æ®ï¼Œå³ç›¸åº”çš„ç´¢å¼•å€¼ï¼‰
      .text(title);

  return svg.node();
}

/**
 *
 * æ„å»º svg
 *
 */
const container = document.getElementById("container"); // å›¾åƒçš„å®¹å™¨

// è·å–å°ºå¯¸å¤§å°
const width = container.clientWidth; // å®½åº¦
const height = container.clientHeight; // é«˜åº¦
const margin = { top: 20, right: 20, bottom: 30, left: 20 };

// åˆ›å»º svg
// åœ¨å®¹å™¨ <div id="container"> å…ƒç´ å†…åˆ›å»ºä¸€ä¸ª SVG å…ƒç´ 
// è¿”å›ä¸€ä¸ªé€‰æ‹©é›†ï¼Œåªæœ‰ svg ä¸€ä¸ªå…ƒç´ 
const svg = d3
  .select("#container")
  .append("svg")
  .attr("width", width)
  .attr("height", height)
  .attr("viewBox", [0, 0, width, height]);

/**
 *
 * å¼‚æ­¥è·å–æ•°æ®
 * å†åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œç»˜åˆ¶æ“ä½œ
 *
 */
// æ•°æ®æ¥æºç½‘é¡µ https://observablehq.com/@d3/bar-chart çš„æ–‡ä»¶é™„ä»¶
const dataURL =
  "https://gist.githubusercontent.com/Benbinbin/04f66f9f466d8293c798cefdd8a36021/raw/686830fb1232d7ea7ca8014b3bf959ab928e173a/alphabet.csv";

d3.csv(dataURL, d3.autoType).then((data) => {
  // éœ€è¦æ£€æŸ¥ä¸€ä¸‹æ•°æ®è§£æçš„ç»“æœï¼Œå¯èƒ½å¹¶ä¸æ­£ç¡®ï¼Œéœ€è¦åœ¨åé¢çš„æ­¥éª¤é‡Œå†è¿›è¡Œç›¸åº”çš„å¤„ç†
  console.log(data);

  // æ„å»ºæ•£ç‚¹å›¾çŸ©é˜µ
  BarChart(data, svg, {
    x: (d) => d.letter,
    y: (d) => d.frequency,
    // è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼ å…¥æ¨ªè½´çš„å®šä¹‰åŸŸ xDomain æ‰‹åŠ¨è®¾ç½®åˆ†ç»„ç±»åˆ«
    // å¹¶ä¸”ç±»åˆ«æ˜¯æŒ‰ç…§å…¶ç›¸åº”çš„é¢‘æ¬¡è¿›è¡Œé™åºæ’åˆ—çš„
    // ä½¿ç”¨æ–¹æ³• d3.groupSort(iterable, accessor, key) å¯¹å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚æ•°ç»„ï¼‰iterable è¿›è¡Œå½’ç±»åˆ†ç»„ï¼Œå…¶ä¸­ key æŒ‡å®šåˆ†ç»„çš„ä¾æ®
    // æœ€åè¿”å›ï¼ˆæ’åºå¥½çš„ï¼‰ç±»åˆ«æ•°ç»„ï¼Œæœ€ç»ˆçš„è¾“å‡ºå€¼å¯ä»¥æŸ¥çœ‹ ğŸ‘‡ ä¸‹ä¸€ä¸ª cell æ‰€æ¼”ç¤ºçš„ç»“æœ
    // ç”±äºè¯¥æ–¹æ³•é»˜è®¤æŒ‰ç…§ accessor è®¿é—®å™¨çš„è¿”å›å€¼å‡åºæ’åˆ—ï¼Œè¿™é‡Œæ˜¯å¸Œæœ›é™åºæ’åˆ—ï¼Œä»…ä»…éœ€è¦åœ¨è¿”å›å€¼å‰é¢æ·»åŠ è´Ÿå· - å³å¯
    xDomain: d3.groupSort(
      data,
      ([d]) => -d.frequency,
      (d) => d.letter
    ),
    yFormat: "%", // çºµè½´çš„åˆ»åº¦å€¼é‡‡ç”¨ç™¾åˆ†æ¯”è¡¨ç¤º
    yLabel: "â†‘ Frequency",
    marginTop: margin.top, // the top margin, in pixels
    marginRight: margin.right, // the right margin, in pixels
    marginBottom: margin.bottom, // the bottom margin, in pixels
    marginLeft: margin.left, // t
    width: width,
    height: height,
    color: "steelblue"
  });
});